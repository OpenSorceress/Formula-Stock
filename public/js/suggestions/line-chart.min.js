/* &copy; 2015 Lindsay Roberts http://www.designbyfish.com/ */
!function(a){function b(b){function d(){if(h<b.length){var i=g(b[h].ticker),l=f(new Date),m=f(new Date((new Date).getTime()-2592e6)),n="6SfHcXos6YBX51kuAq8B",o="https://www.quandl.com/api/v1/datasets/WIKI/"+i+".json?trim_start="+m+"&trim_end="+l+"&auth_token="+n;i.indexOf("_TO")>-1&&(o="https://www.quandl.com/api/v1/datasets/YAHOO/TSX_"+i+".json?trim_start="+m+"&trim_end="+l+"&auth_token="+n),a.ajax({url:o,success:function(a){j.push(a),h++,d()},error:function(){o="https://www.quandl.com/api/v1/datasets/GOOG/NASDAQ_"+i+".json?trim_start="+m+"&trim_end="+l+"&auth_token="+n,a.ajax({url:o,success:function(a){j.push(a),h++,d()},error:function(){o="https://www.quandl.com/api/v1/datasets/GOOG/NYSE_"+i+".json?trim_start="+m+"&trim_end="+l+"&auth_token="+n,a.ajax({url:o,success:function(a){j.push(a),h++,d()},error:function(){o="https://www.quandl.com/api/v1/datasets/GOOG/AMEX_"+i+".json?trim_start="+m+"&trim_end="+l+"&auth_token="+n,a.ajax({url:o,success:function(a){j.push(a),h++,d()},error:function(){j.push({error:"Could not retrieve data for "+i}),h++,d()}})}})}})}})}else{for(var p=0;p<j.length;p++)if(j[p].error){console.log("There was an error for line-chart-"+p);var q="#line-chart-"+p;a(q).parent().addClass("line-chart-error");var r="Data could not be retrieved for "+b[p].ticker;a(q).html('<p class="chart-error"><i class="fa fa-exclamation-triangle fa-lg"></i><br />'+r+"</p>")}else{var s=e(j[p],b[p].suggested_price),s=s.reverse(),t=c(s,b[p].suggested_price,b[p].action),u="line-chart-"+p;k.push(AmCharts.makeChart(u,t)),console.log("Data was retrieved for line-chart-"+p)}console.log(k)}}var h=0;d()}function c(a,b,c){var e="#D9124A",f="#12D99E";return"SELL"==c&&(e="#12D99E",f="#D9124A"),{type:"serial",theme:"light",marginTop:0,marginRight:0,marginLeft:0,marginBottom:25,autoMargins:!1,pathToImages:"/js/amcharts/images/",dataProvider:a,valueAxes:[{inside:!0,axisAlpha:0}],graphs:[{balloonText:"<div style='magin:5px; font-size:18px;'><span style='font-size:13px;'>[[price]]</span></div>",bullet:"round",bulletBorderAlpha:1,bulletBorderColor:"#FFFFFF",hideBulletsCount:50,lineThickness:2,lineColor:e,negativeLineColor:f,valueField:"value",negativeBase:b}],chartScrollbar:{enabled:!1},chartCursor:{},categoryField:"date",categoryAxis:{parseDates:!0,axisAlpha:0,minHorizontalGap:55},valueAxis:{labelFunction:d},guides:[{value:b,lineColor:"#18AED5",lineAlpha:1,lineThickness:2,position:"right"}]}}function d(a,b){return b="$"+a+".00"}function e(a){var b=[];return a.data.forEach(function(a){b.push({date:new Date(a[0]),price:h(a[4].toFixed(2)),value:a[4]})}),b}function f(a){var b=new Date(a),c=""+(b.getMonth()+1),d=""+b.getDate(),e=b.getFullYear();return c.length<2&&(c="0"+c),d.length<2&&(d="0"+d),[e,c,d].join("-")}function g(a){var b=a.split(".").join("_");return b}function h(a){for(;/(\d+)(\d{3})/.test(a.toString());)a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2");return"$"+a}var i={actionable:[{date:{day:"17",month:"4",year:"2015"},name:"CARBO CERAMICS      ",ticker:"CRR",action:"SELL",suggested_price:31.19,percentage_weight:99.9983,advanced_data:[{name:"cyclically_adjusted_earnings_yield",display_name:"Cyclically Adjusted Earnings Yield",value:9.87048,unit:"percent",description:"The cyclically adjusted price-to-earnings ratio is a valuation measure usually applied to the US S&P 500 equity market."},{name:"dividend_yield",display_name:"Divident Yield",value:4.03976,unit:"percent",description:"The dividend yield of a share is the dividend per share, divided by the price per share."}]},{date:{day:"17",month:"4",year:"2015"},name:"CARBO CERAMICS      ",ticker:"NUS",action:"BUY",suggested_price:60.11,percentage_weight:35.9983,advanced_data:[{name:"cyclically_adjusted_earnings_yield",display_name:"Cyclically Adjusted Earnings Yield",value:9.87048,unit:"percent",description:"The cyclically adjusted price-to-earnings ratio is a valuation measure usually applied to the US S&P 500 equity market."},{name:"dividend_yield",display_name:"Divident Yield",value:4.03976,unit:"percent",description:"The dividend yield of a share is the dividend per share, divided by the price per share."}]}]},j=[],k=[];b(i.actionable)}(jQuery);